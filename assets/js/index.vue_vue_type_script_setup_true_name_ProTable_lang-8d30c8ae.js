import{R as ge,x as E,aA as Ie,i as V,d as I,G,o as _,h as z,aB as _e,w as b,a as B,t as de,c as A,f as ae,F as x,ad as L,y as O,u as k,aC as U,A as te,ai as Re,T as ve,aD as Te,aE as De,aF as Le,aG as K,aH as be,U as le,B as ye,aI as Ae,a4 as we,aJ as Ce,r as N,b as C,z as Se,e as ue,a2 as Me,aK as je,aL as Fe,Y as T,q as xe,p as Oe,g as Ue,aq as ee,aM as ke,aN as qe,aO as he,aP as ce,aQ as He,aR as Ge,s as Ke,H as We,aS as Je}from"./index-63c25652.js";import{_ as $e,S as Qe}from"./sortable.esm-aea8cdfd.js";import{_ as Ye}from"./_plugin-vue_export-helper-c27b6911.js";const Xe=(y,r={},s=!0,l,i)=>{const n=ge({tableData:[],pageable:{pageNum:1,pageSize:10,total:0},searchParam:{},searchInitParam:{},totalParam:{}}),t=E({get:()=>({pageNum:n.pageable.pageNum,pageSize:n.pageable.pageSize}),set:d=>{}}),a=async()=>{if(y)try{Object.assign(n.totalParam,r,s?t.value:{});let{data:d}=await y({...n.searchInitParam,...n.totalParam});if(l&&(d=l(d)),n.tableData=s?d.list:d,s){const{pageNum:h,pageSize:D,total:$}=d;e({pageNum:h,pageSize:D,total:$})}}catch(d){i&&i(d)}},f=()=>{n.totalParam={};let d={};for(let h in n.searchParam)(n.searchParam[h]||n.searchParam[h]===!1||n.searchParam[h]===0)&&(d[h]=n.searchParam[h]);Object.assign(n.totalParam,d,s?t.value:{})},e=d=>{Object.assign(n.pageable,d)},o=()=>{n.pageable.pageNum=1,f(),a()},u=()=>{n.pageable.pageNum=1,n.searchParam={...n.searchInitParam},f(),a()},c=d=>{n.pageable.pageNum=1,n.pageable.pageSize=d,a()},v=d=>{n.pageable.pageNum=d,a()};return{...Ie(n),getTableList:a,search:o,reset:u,handleSizeChange:c,handleCurrentChange:v,updatedTotalParam:f}},Ze=(y="id")=>{const r=V(!1),s=V([]),l=E(()=>{let n=[];return s.value.forEach(t=>n.push(t[y])),n});return{isSelected:r,selectedList:s,selectedListIds:l,selectionChange:n=>{n.length?r.value=!0:r.value=!1,s.value=n}}},ea=I({name:"SearchFormItem"}),aa=I({...ea,props:{column:{},searchParam:{}},setup(y){const r=y,s=E(()=>r.searchParam),l=E(()=>{var e,o,u;return{label:((e=r.column.fieldNames)==null?void 0:e.label)??"label",value:((o=r.column.fieldNames)==null?void 0:o.value)??"value",children:((u=r.column.fieldNames)==null?void 0:u.children)??"children"}}),i=G("enumMap",V(new Map)),n=E(()=>{var o;let e=i.value.get(r.column.prop);return e?(((o=r.column.search)==null?void 0:o.el)==="select-v2"&&r.column.fieldNames&&(e=e.map(u=>({...u,label:u[l.value.label],value:u[l.value.value]}))),e):[]}),t=E(()=>{var d,h;const e=l.value.label,o=l.value.value,u=l.value.children,c=(d=r.column.search)==null?void 0:d.el;let v=((h=r.column.search)==null?void 0:h.props)??{};return c==="tree-select"&&(v={...v,props:{...v.props,label:e,children:u},nodeKey:o}),c==="cascader"&&(v={...v,props:{...v.props,label:e,value:o,children:u}}),v}),a=E(()=>{var u,c,v,d;const e=r.column.search;return["datetimerange","daterange","monthrange"].includes((u=e==null?void 0:e.props)==null?void 0:u.type)||(c=e==null?void 0:e.props)!=null&&c.isRange?{rangeSeparator:"至",startPlaceholder:"开始时间",endPlaceholder:"结束时间"}:{placeholder:((v=e==null?void 0:e.props)==null?void 0:v.placeholder)??((d=e==null?void 0:e.el)!=null&&d.includes("input")?"请输入":"请选择")}}),f=E(()=>{var o;const e=r.column.search;return((o=e==null?void 0:e.props)==null?void 0:o.clearable)??((e==null?void 0:e.defaultValue)==null||(e==null?void 0:e.defaultValue)==null)});return(e,o)=>{var u,c,v,d,h,D;return _(),z(te(((u=e.column.search)==null?void 0:u.render)??`el-${(c=e.column.search)==null?void 0:c.el}`),O({...t.value,...a.value,searchParam:s.value,clearable:f.value},{modelValue:s.value[((v=e.column.search)==null?void 0:v.key)??k(U)(e.column.prop)],"onUpdate:modelValue":o[0]||(o[0]=$=>{var w;return s.value[((w=e.column.search)==null?void 0:w.key)??k(U)(e.column.prop)]=$}),modelModifiers:{trim:!0},data:((d=e.column.search)==null?void 0:d.el)==="tree-select"?n.value:[],options:["cascader","select-v2"].includes((h=e.column.search)==null?void 0:h.el)?n.value:[]}),_e({default:b(()=>{var $;return[(($=e.column.search)==null?void 0:$.el)==="select"?(_(!0),A(x,{key:0},ae(n.value,(w,R)=>(_(),z(te("el-option"),{key:R,label:w[l.value.label],value:w[l.value.value]},null,8,["label","value"]))),128)):L(e.$slots,"default",{key:1})]}),_:2},[((D=e.column.search)==null?void 0:D.el)==="cascader"?{name:"default",fn:b(({data:$})=>[B("span",null,de($[l.value.label]),1)]),key:"0"}:void 0]),1040,["modelValue","data","options"])}}}),ta=I({name:"Grid"}),la=I({...ta,props:{cols:{default:()=>({xs:1,sm:2,md:2,lg:3,xl:4})},collapsed:{type:Boolean,default:!1},collapsedRows:{default:1},gap:{default:0}},setup(y,{expose:r}){const s=y;Re(()=>s.collapsed&&f()),ve(()=>{l({target:{innerWidth:window.innerWidth}}),window.addEventListener("resize",l)}),Te(()=>{l({target:{innerWidth:window.innerWidth}}),window.addEventListener("resize",l)}),De(()=>{window.removeEventListener("resize",l)}),Le(()=>{window.removeEventListener("resize",l)});const l=u=>{let c=u.target.innerWidth;switch(!!c){case c<768:i.value="xs";break;case(c>=768&&c<992):i.value="sm";break;case(c>=992&&c<1200):i.value="md";break;case(c>=1200&&c<1920):i.value="lg";break;case c>=1920:i.value="xl";break}};K("gap",Array.isArray(s.gap)?s.gap[0]:s.gap);let i=V("xl");K("breakPoint",i);const n=V(-1);K("shouldHiddenIndex",n);const t=E(()=>typeof s.cols=="object"?s.cols[i.value]??s.cols:s.cols);K("cols",t);const a=be().default(),f=()=>{var d,h,D,$;let u=[],c=null;a.forEach(w=>{var R;typeof w.type=="object"&&w.type.name==="GridItem"&&((R=w.props)==null?void 0:R.suffix)!==void 0&&(c=w),typeof w.type=="symbol"&&Array.isArray(w.children)&&u.push(...w.children)});let v=0;c&&(v=(((d=c.props[i.value])==null?void 0:d.span)??((h=c.props)==null?void 0:h.span)??1)+(((D=c.props[i.value])==null?void 0:D.offset)??(($=c.props)==null?void 0:$.offset)??0));try{let w=!1;u.reduce((R=0,M,W)=>{var J,j,q,Q;if(R+=(((J=M.props[i.value])==null?void 0:J.span)??((j=M.props)==null?void 0:j.span)??1)+(((q=M.props[i.value])==null?void 0:q.offset)??((Q=M.props)==null?void 0:Q.offset)??0),Number(R)>s.collapsedRows*t.value-v)throw n.value=W,w=!0,"find it";return R},0),w||(n.value=-1)}catch{}};le(()=>i.value,()=>{s.collapsed&&f()}),le(()=>s.collapsed,u=>{if(u)return f();n.value=-1});const e=E(()=>typeof s.gap=="number"?`${s.gap}px`:Array.isArray(s.gap)?`${s.gap[1]}px ${s.gap[0]}px`:"unset"),o=E(()=>({display:"grid",gridGap:e.value,gridTemplateColumns:`repeat(${t.value}, minmax(0, 1fr))`}));return r({breakPoint:i}),(u,c)=>(_(),A("div",{style:ye(o.value)},[L(u.$slots,"default")],4))}}),na=I({name:"GridItem"}),me=I({...na,props:{offset:{default:0},span:{default:1},suffix:{type:Boolean,default:!1},xs:{default:void 0},sm:{default:void 0},md:{default:void 0},lg:{default:void 0},xl:{default:void 0}},setup(y){const r=y,s=Ae(),l=V(!0),i=G("breakPoint",V("xl")),n=G("shouldHiddenIndex",V(-1));le(()=>[n.value,i.value],e=>{s.index&&(l.value=!(e[0]!==-1&&parseInt(s.index)>=Number(e[0])))},{immediate:!0});const t=G("gap",0),a=G("cols",V(4)),f=E(()=>{var u,c;let e=((u=r[i.value])==null?void 0:u.span)??r.span,o=((c=r[i.value])==null?void 0:c.offset)??r.offset;return r.suffix?{gridColumnStart:a.value-e-o+1,gridColumnEnd:`span ${e+o}`,marginLeft:o!==0?`calc(((100% + ${t}px) / ${e+o}) * ${o})`:"unset"}:{gridColumn:`span ${e+o>a.value?a.value:e+o}/span ${e+o>a.value?a.value:e+o}`,marginLeft:o!==0?`calc(((100% + ${t}px) / ${e+o}) * ${o})`:"unset"}});return(e,o)=>we((_(),A("div",{style:ye(f.value)},[L(e.$slots,"default")],4)),[[Ce,l.value]])}}),oa={key:0,class:"card table-search"},ra=B("i",{class:xe("iconfont icon-yiwen")},null,-1),sa=B("span",null,":",-1),ua={class:"operation"},ca=I({name:"SearchForm"}),da=I({...ca,props:{columns:{default:()=>[]},searchParam:{default:()=>({})},searchCol:{},search:{},reset:{}},setup(y){const r=y,s=a=>{var f,e,o,u,c,v,d;return{span:(f=a.search)==null?void 0:f.span,offset:((e=a.search)==null?void 0:e.offset)??0,xs:(o=a.search)==null?void 0:o.xs,sm:(u=a.search)==null?void 0:u.sm,md:(c=a.search)==null?void 0:c.md,lg:(v=a.search)==null?void 0:v.lg,xl:(d=a.search)==null?void 0:d.xl}},l=V(!0),i=V(),n=E(()=>{var a;return(a=i.value)==null?void 0:a.breakPoint}),t=E(()=>{let a=!1;return r.columns.reduce((f,e)=>{var o,u,c,v;return f+=(((o=e.search[n.value])==null?void 0:o.span)??((u=e.search)==null?void 0:u.span)??1)+(((c=e.search[n.value])==null?void 0:c.offset)??((v=e.search)==null?void 0:v.offset)??0),typeof r.searchCol!="number"?f>=r.searchCol[n.value]&&(a=!0):f>=r.searchCol&&(a=!0),f},0),a});return(a,f)=>{const e=N("el-tooltip"),o=N("el-space"),u=N("el-form-item"),c=N("el-button"),v=N("el-icon"),d=N("el-form");return a.columns.length?(_(),A("div",oa,[C(d,{ref:"formRef",model:a.searchParam},{default:b(()=>[C(la,{ref_key:"gridRef",ref:i,collapsed:l.value,gap:[20,0],cols:a.searchCol},{default:b(()=>[(_(!0),A(x,null,ae(a.columns,(h,D)=>(_(),z(me,O({key:h.prop},s(h),{index:D}),{default:b(()=>[C(u,null,{label:b(()=>[C(o,{size:4},{default:b(()=>{var $,w,R;return[B("span",null,de(`${(($=h.search)==null?void 0:$.label)??h.label}`),1),(w=h.search)!=null&&w.tooltip?(_(),z(e,{key:0,effect:"dark",content:(R=h.search)==null?void 0:R.tooltip,placement:"top"},{default:b(()=>[ra]),_:2},1032,["content"])):T("",!0)]}),_:2},1024),sa]),default:b(()=>[C(aa,{column:h,"search-param":a.searchParam},null,8,["column","search-param"])]),_:2},1024)]),_:2},1040,["index"]))),128)),C(me,{suffix:""},{default:b(()=>[B("div",ua,[C(c,{type:"primary",icon:k(Se),onClick:a.search},{default:b(()=>[ue(" 搜索 ")]),_:1},8,["icon","onClick"]),C(c,{icon:k(Me),onClick:a.reset},{default:b(()=>[ue(" 重置 ")]),_:1},8,["icon","onClick"]),t.value?(_(),z(c,{key:0,type:"primary",link:"",class:"search-isOpen",onClick:f[0]||(f[0]=h=>l.value=!l.value)},{default:b(()=>[ue(de(l.value?"展开":"合并")+" ",1),C(v,{class:"el-icon--right"},{default:b(()=>[(_(),z(te(l.value?k(je):k(Fe))))]),_:1})]),_:1})):T("",!0)])]),_:1})]),_:1},8,["collapsed","cols"])]),_:1},8,["model"])])):T("",!0)}}}),pa=I({name:"Pagination"}),ia=I({...pa,props:{pageable:{},handleSizeChange:{type:Function},handleCurrentChange:{type:Function}},setup(y){return(r,s)=>{const l=N("el-pagination");return _(),z(l,{background:!0,"current-page":r.pageable.pageNum,"page-size":r.pageable.pageSize,"page-sizes":[10,25,50,100],total:r.pageable.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:r.handleSizeChange,onCurrentChange:r.handleCurrentChange},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"])}}}),fa=y=>(Oe("data-v-e43c0450"),y=y(),Ue(),y),ha={class:"table-main"},ma=fa(()=>B("div",{class:"table-empty"},[B("img",{src:$e,alt:"notData"}),B("div",null,"暂无可配置列")],-1)),ga=I({name:"ColSetting"}),_a=I({...ga,props:{colSetting:{}},setup(y,{expose:r}){const s=V(!1);return r({openColSetting:()=>{s.value=!0}}),(i,n)=>{const t=N("el-table-column"),a=N("el-switch"),f=N("el-table"),e=N("el-drawer");return _(),z(e,{modelValue:s.value,"onUpdate:modelValue":n[0]||(n[0]=o=>s.value=o),title:"列设置",size:"450px"},{default:b(()=>[B("div",ha,[C(f,{data:i.colSetting,border:!0,"row-key":"prop","default-expand-all":"","tree-props":{children:"_children"}},{empty:b(()=>[ma]),default:b(()=>[C(t,{prop:"label",align:"center",label:"列名"}),C(t,{prop:"isShow",align:"center",label:"显示"},{default:b(o=>[C(a,{modelValue:o.row.isShow,"onUpdate:modelValue":u=>o.row.isShow=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),C(t,{prop:"sortable",align:"center",label:"排序"},{default:b(o=>[C(a,{modelValue:o.row.sortable,"onUpdate:modelValue":u=>o.row.sortable=u},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])])]),_:1},8,["modelValue"])}}});const va=Ye(_a,[["__scopeId","data-v-e43c0450"]]);function ba(y){return typeof y=="function"||Object.prototype.toString.call(y)==="[object Object]"&&!qe(y)}const ya=I({name:"TableColumn"}),wa=I({...ya,props:{column:{}},setup(y){const r=be(),s=G("enumMap",V(new Map)),l=(t,a)=>s.value.get(t.prop)&&t.isFilterEnum?he(ce(a.row,t.prop),s.value.get(t.prop),t.fieldNames):He(ce(a.row,t.prop)),i=(t,a)=>he(ce(a.row,t.prop),s.value.get(t.prop),t.fieldNames,"tag"),n=t=>C(x,null,[t.isShow&&C(N("el-table-column"),O(t,{align:t.align??"center",showOverflowTooltip:t.showOverflowTooltip??t.prop!=="operation"}),{default:a=>{let f;return t._children?t._children.map(e=>n(e)):t.render?t.render(a):r[U(t.prop)]?r[U(t.prop)](a):t.tag?C(N("el-tag"),{type:i(t,a)},ba(f=l(t,a))?f:{default:()=>[f]}):l(t,a)},header:a=>t.headerRender?t.headerRender(a):r[`${U(t.prop)}Header`]?r[`${U(t.prop)}Header`](a):t.label})]);return(t,a)=>(_(),z(n,ee(ke(t.column)),null,16))}}),Ca={class:"card table-main"},Sa={class:"table-header"},ka={class:"header-button-lf"},$a={key:0,class:"header-button-ri"},Pa=B("i",null,null,-1),za={class:"table-empty"},Na=B("img",{src:$e,alt:"notData"},null,-1),Va=B("div",null,"暂无数据",-1),Ea=I({name:"ProTable"}),Ta=I({...Ea,props:{columns:{default:()=>[]},data:{},requestApi:{},requestAuto:{type:Boolean,default:!0},requestError:{},dataCallback:{},title:{},pagination:{type:Boolean,default:!0},initParam:{default:{}},border:{type:Boolean,default:!0},toolButton:{type:[Array,Boolean],default:!0},rowKey:{default:"id"},searchCol:{default:()=>({xs:1,sm:2,md:2,lg:3,xl:4})}},emits:["search","reset","dargSort"],setup(y,{expose:r,emit:s}){var fe;const l=y,i=V(),n=["selection","radio","index","expand","sort"],t=V(!0),a=p=>Array.isArray(l.toolButton)?l.toolButton.includes(p):l.toolButton,f=V(""),{selectionChange:e,selectedList:o,selectedListIds:u,isSelected:c}=Ze(l.rowKey),{tableData:v,pageable:d,searchParam:h,searchInitParam:D,getTableList:$,search:w,reset:R,handleSizeChange:M,handleCurrentChange:W}=Xe(l.requestApi,l.initParam,l.pagination,l.dataCallback,l.requestError),J=()=>i.value.clearSelection();ve(()=>{Ee(),l.requestAuto&&$(),l.data&&(d.value.total=l.data.length)});const j=E(()=>l.data?l.pagination?l.data.slice((d.value.pageNum-1)*d.value.pageSize,d.value.pageSize*d.value.pageNum):l.data:v.value);le(()=>l.initParam,$,{deep:!0});const q=ge(l.columns),Q=E(()=>pe(q)),H=V(new Map),Pe=async({prop:p,enum:m})=>{if(!m||H.value.has(p)&&(typeof m=="function"||H.value.get(p)===m))return;if(typeof m!="function")return H.value.set(p,k(m));const{data:g}=await m();H.value.set(p,g)};K("enumMap",H);const pe=(p,m=[])=>(p.forEach(async g=>{var P;(P=g._children)!=null&&P.length&&m.push(...pe(g._children)),m.push(g),g.isShow=g.isShow??!0,g.isFilterEnum=g.isFilterEnum??!0,await Pe(g)}),m.filter(g=>{var P;return!((P=g._children)!=null&&P.length)})),ne=E(()=>{var p;return(p=Q.value)==null?void 0:p.filter(m=>{var g,P;return((g=m.search)==null?void 0:g.el)||((P=m.search)==null?void 0:P.render)}).sort((m,g)=>m.search.order-g.search.order)});(fe=ne.value)==null||fe.forEach((p,m)=>{var Y,X,Z;p.search.order=((Y=p.search)==null?void 0:Y.order)??m+2;const g=((X=p.search)==null?void 0:X.key)??U(p.prop),P=(Z=p.search)==null?void 0:Z.defaultValue;P!=null&&(D.value[g]=P,h.value[g]=P)});const ie=V(),oe=q.filter(p=>{const{type:m,prop:g,isShow:P}=p;return!n.includes(m)&&g!=="operation"&&P}),ze=()=>ie.value.openColSetting(),re=s,Ne=()=>{w(),re("search")},Ve=()=>{R(),re("reset")},Ee=()=>{const p=document.querySelector(".el-table__body-wrapper tbody");Qe.create(p,{handle:".move",animation:300,onEnd({newIndex:m,oldIndex:g}){const[P]=j.value.splice(g,1);j.value.splice(m,0,P),re("dargSort",{newIndex:m,oldIndex:g})}})};return r({element:i,tableData:j,radio:f,pageable:d,searchParam:h,searchInitParam:D,getTableList:$,search:w,reset:R,handleSizeChange:M,handleCurrentChange:W,clearSelection:J,enumMap:H,isSelected:c,selectedList:o,selectedListIds:u}),(p,m)=>{const g=N("el-button"),P=N("el-radio"),Y=N("DCaret"),X=N("el-icon"),Z=N("el-tag"),Be=N("el-table-column");return _(),A(x,null,[we(C(da,{search:Ne,reset:Ve,columns:ne.value,"search-param":k(h),"search-col":p.searchCol},null,8,["columns","search-param","search-col"]),[[Ce,t.value]]),B("div",Ca,[B("div",Sa,[B("div",ka,[L(p.$slots,"tableHeader",{selectedList:k(o),selectedListIds:k(u),isSelected:k(c)})]),p.toolButton?(_(),A("div",$a,[L(p.$slots,"toolButton",{},()=>{var S;return[a("refresh")?(_(),z(g,{key:0,icon:k(We),circle:"",onClick:k($)},null,8,["icon","onClick"])):T("",!0),a("setting")&&p.columns.length?(_(),z(g,{key:1,icon:k(Je),circle:"",onClick:ze},null,8,["icon"])):T("",!0),a("search")&&((S=ne.value)!=null&&S.length)?(_(),z(g,{key:2,icon:k(Se),circle:"",onClick:m[0]||(m[0]=F=>t.value=!t.value)},null,8,["icon"])):T("",!0)]})])):T("",!0)]),C(k(Ge),O({ref_key:"tableRef",ref:i},p.$attrs,{data:j.value,border:p.border,"row-key":p.rowKey,onSelectionChange:k(e)}),{append:b(()=>[L(p.$slots,"append")]),empty:b(()=>[B("div",za,[L(p.$slots,"empty",{},()=>[Na,Va])])]),default:b(()=>[L(p.$slots,"default"),(_(!0),A(x,null,ae(q,S=>(_(),A(x,{key:S},[S.type&&n.includes(S.type)?(_(),z(Be,O({key:0},S,{align:S.align??"center","reserve-selection":S.type=="selection"}),{default:b(F=>[S.type=="expand"?(_(),A(x,{key:0},[S.render?(_(),z(te(S.render),ee(O({key:0},F)),null,16)):L(p.$slots,S.type,ee(O({key:1},F)))],64)):T("",!0),S.type=="radio"?(_(),z(P,{key:1,modelValue:f.value,"onUpdate:modelValue":m[1]||(m[1]=se=>f.value=se),label:F.row[p.rowKey]},{default:b(()=>[Pa]),_:2},1032,["modelValue","label"])):T("",!0),S.type=="sort"?(_(),z(Z,{key:2,class:"move"},{default:b(()=>[C(X,null,{default:b(()=>[C(Y)]),_:1})]),_:1})):T("",!0)]),_:2},1040,["align","reserve-selection"])):T("",!0),!S.type&&S.prop&&S.isShow?(_(),z(wa,{key:1,column:S},_e({_:2},[ae(Object.keys(p.$slots),F=>({name:F,fn:b(se=>[L(p.$slots,F,ee(ke(se)))])}))]),1032,["column"])):T("",!0)],64))),128))]),_:3},16,["data","border","row-key","onSelectionChange"]),L(p.$slots,"pagination",{},()=>[p.pagination?(_(),z(ia,{key:0,pageable:k(d),"handle-size-change":k(M),"handle-current-change":k(W)},null,8,["pageable","handle-size-change","handle-current-change"])):T("",!0)])]),p.toolButton?(_(),z(va,{key:0,ref_key:"colRef",ref:ie,"col-setting":k(oe),"onUpdate:colSetting":m[2]||(m[2]=S=>Ke(oe)?oe.value=S:null)},null,8,["col-setting"])):T("",!0)],64)}}});export{Ta as _};
